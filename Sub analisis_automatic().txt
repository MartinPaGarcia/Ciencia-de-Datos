Sub analisis_automatic()
'
' analisis_automatic Macro
' 
' Intend to use in "Final Proyect" or symilars
'
' Create two excel Sheets, "Analysis" and "Graph
'
' Analysis: 
'  PivotTable from Table "food" and
'  from parameters "Calories over time 
'
' Graph:
'  Chart "Calories X Time" of calories over time
'  slicer "hora" and "persona" tp fileter and analys data
'
'



'
    Sheets("Data").Select
    Range("A1").Select
    Range(Selection, Selection.End(xlToRight)).Select
    Range(Selection, Selection.End(xlDown)).Select
    Application.CutCopyMode = False
    ActiveSheet.ListObjects.Add(xlSrcRange, Range("$A$1:$BJ$1801"), , xlYes).Name _
        = "Table1"
    Range("Table1[#All]").Select
    ActiveSheet.ListObjects("Table1").Name = "food"
    Range("food[[#Headers],[fecha]]").Select
    Sheets.Add
    Sheets("Sheet1").Select
    Sheets("Sheet1").Name = "Analisis"
    ActiveWorkbook.PivotCaches.Create(SourceType:=xlDatabase, SourceData:= _
        "food", Version:=8).CreatePivotTable TableDestination:="Analisis!R1C1", _
        TableName:="PivotTable1", DefaultVersion:=8
    Sheets("Analisis").Select
    Cells(1, 1).Select
    With ActiveSheet.PivotTables("PivotTable1")
        .ColumnGrand = True
        .HasAutoFormat = True
        .DisplayErrorString = False
        .DisplayNullString = True
        .EnableDrilldown = True
        .ErrorString = ""
        .MergeLabels = False
        .NullString = ""
        .PageFieldOrder = 2
        .PageFieldWrapCount = 0
        .PreserveFormatting = True
        .RowGrand = True
        .SaveData = True
        .PrintTitles = False
        .RepeatItemsOnEachPrintedPage = True
        .TotalsAnnotation = False
        .CompactRowIndent = 1
        .InGridDropZones = False
        .DisplayFieldCaptions = True
        .DisplayMemberPropertyTooltips = False
        .DisplayContextTooltips = True
        .ShowDrillIndicators = True
        .PrintDrillIndicators = False
        .AllowMultipleFilters = False
        .SortUsingCustomLists = True
        .FieldListSortAscending = False
        .ShowValuesRow = False
        .CalculatedMembersInFilters = False
        .RowAxisLayout xlCompactRow
    End With
    With ActiveSheet.PivotTables("PivotTable1").PivotCache
        .RefreshOnFileOpen = False
        .MissingItemsLimit = xlMissingItemsDefault
    End With
    ActiveSheet.PivotTables("PivotTable1").RepeatAllLabels xlRepeatLabels
    With ActiveSheet.PivotTables("PivotTable1").PivotFields("fecha")
        .Orientation = xlRowField
        .Position = 1
    End With
    With ActiveSheet.PivotTables("PivotTable1").PivotFields("hora")
        .Orientation = xlRowField
        .Position = 2
    End With
    With ActiveSheet.PivotTables("PivotTable1").PivotFields("persona")
        .Orientation = xlRowField
        .Position = 3
    End With
    ActiveSheet.PivotTables("PivotTable1").AddDataField ActiveSheet.PivotTables( _
        "PivotTable1").PivotFields("calories"), "Sum of calories", xlSum
    ActiveSheet.Shapes.AddChart2(227, xlLine).Select
    ActiveChart.SetSourceData Source:=Range("Analisis!$A$1:$B$2502")
    ActiveChart.Parent.Cut
    Sheets.Add
    Sheets("Sheet2").Select
    Sheets("Sheet2").Name = "Graph"
    ActiveSheet.Paste
    ActiveSheet.ChartObjects("Chart 1").Activate
    ActiveSheet.Shapes("Chart 1").ScaleWidth 1.8097222222, msoFalse, _
        msoScaleFromTopLeft
    ActiveSheet.Shapes("Chart 1").ScaleHeight 1.3773148148, msoFalse, _
        msoScaleFromTopLeft
    ActiveSheet.ChartObjects("Chart 1").Activate
    ActiveChart.Axes(xlCategory).Select
    Selection.Delete
    ActiveSheet.ChartObjects("Chart 1").Activate
    ActiveChart.Legend.Select
    Selection.Delete
    ActiveSheet.ChartObjects("Chart 1").Activate
    ActiveChart.Axes(xlValue).MajorGridlines.Select
    Selection.Delete
    ActiveSheet.ChartObjects("Chart 1").Activate
    ActiveChart.ShowAllFieldButtons = False
    ActiveSheet.ChartObjects("Chart 1").Activate
    ActiveChart.FullSeriesCollection(1).Select
    With Selection.Format.Fill
        .Visible = msoTrue
        .ForeColor.RGB = RGB(146, 208, 80)
        .Transparency = 0
        .Solid
    End With
    With Selection.Format.Line
        .Visible = msoTrue
        .ForeColor.RGB = RGB(146, 208, 80)
        .Transparency = 0
    End With
    ActiveChart.ChartTitle.Select
    ActiveChart.ChartTitle.Text = "Calories X Time"
    Selection.Format.TextFrame2.TextRange.Characters.Text = "Calories X Time"
    With Selection.Format.TextFrame2.TextRange.Characters(1, 15).ParagraphFormat
        .TextDirection = msoTextDirectionLeftToRight
        .Alignment = msoAlignCenter
    End With
    With Selection.Format.TextFrame2.TextRange.Characters(1, 15).Font
        .BaselineOffset = 0
        .Bold = msoFalse
        .NameComplexScript = "+mn-cs"
        .NameFarEast = "+mn-ea"
        .Fill.Visible = msoTrue
        .Fill.ForeColor.RGB = RGB(89, 89, 89)
        .Fill.Transparency = 0
        .Fill.Solid
        .Size = 20
        .Italic = msoFalse
        .Kerning = 12
        .Name = "Franklin Gothic Demi Cond"
        .UnderlineStyle = msoNoUnderline
        .Spacing = 0
        .Strike = msoNoStrike
    End With
    Range("I23").Select
    ActiveWindow.DisplayGridlines = False
    ActiveSheet.ChartObjects("Chart 1").Activate
    ActiveSheet.Shapes("Chart 1").Line.Visible = msoFalse
    ActiveWorkbook.SlicerCaches.Add2(ActiveSheet.PivotTables("PivotTable1"), "hora" _
        ).Slicers.Add ActiveSheet, , "hora", "hora", 301.5, 277, 144, 198.75
    ActiveSheet.Shapes.Range(Array("hora")).Select
    ActiveSheet.Shapes("hora").IncrementLeft -113.5
    ActiveSheet.Shapes("hora").IncrementTop -1
    ActiveSheet.ChartObjects("Chart 1").Activate
    ActiveWorkbook.SlicerCaches.Add2(ActiveSheet.PivotTables("PivotTable1"), _
        "persona").Slicers.Add ActiveSheet, , "persona", "persona", 301.5, 277, 144, _
        198.75
    ActiveSheet.Shapes.Range(Array("persona")).Select
    ActiveSheet.Shapes("persona").IncrementLeft 44
    ActiveSheet.Shapes("persona").IncrementTop -2
    ActiveSheet.Shapes.Range(Array("persona", "hora")).Select
    ActiveWorkbook.SlicerCaches("Slicer_persona").Slicers("persona").Style = _
        "SlicerStyleDark3"
    ActiveWorkbook.SlicerCaches("Slicer_hora").Slicers("hora").Style = _
        "SlicerStyleDark3"
    Selection.ShapeRange.ScaleHeight 0.7823899371, msoFalse, msoScaleFromTopLeft
    ActiveSheet.Shapes.Range(Array("persona")).Select
    ActiveSheet.Shapes("persona").ScaleHeight 0.5884239309, msoFalse, _
        msoScaleFromTopLeft
    ActiveSheet.Shapes.Range(Array("hora")).Select
    ActiveSheet.Shapes("hora").ScaleHeight 1.0450155708, msoFalse, _
        msoScaleFromTopLeft
End Sub